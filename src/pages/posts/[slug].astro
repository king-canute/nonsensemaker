---
import { Image } from 'astro:assets';
import ArticleLayout from '../../layouts/ArticleLayout.astro';

export async function getStaticPaths() {
  // Update glob to find 'index.md' files inside subdirectories
  const posts = await import.meta.glob('../../content/articles/**/index.md', { eager: true });

  return Object.entries(posts).map(([path, post]) => {
    // Derive the slug from the parent folder's name
    const pathParts = path.split('/');
    const slug = pathParts[pathParts.length - 2];

    return {
      params: { slug },
      props: { post },
    };
  });
}

const { post } = Astro.props;
const { Content } = post;
---
<ArticleLayout>
  <div class="article-header">
    {post.frontmatter.heroImage && (
      <div class="hero-image">
        <Image 
          src={post.frontmatter.heroImage} 
          alt={post.frontmatter.heroAlt} 
          width={720} 
          height={405}
          formats={['avif', 'webp']}
        />
      </div>
    )}
    <h1>{post.frontmatter.title}</h1>
    <p><em>Published on: {new Date(post.frontmatter.pubDate).toLocaleDateString()}</em></p>
  </div>
  <hr />
  <Content />
</ArticleLayout>

<style>
  .article-header {
    text-align: center;
  }
  .hero-image {
    margin-bottom: 2rem;
  }
  .hero-image img { /* Style the generated <img> tag */
    width: 100%;
    height: auto;
    border-radius: 8px;
  }
  h1 {
    margin-bottom: 0.5rem;
  }
  .article-header p {
    margin-top: 0;
    font-size: 0.9em;
    color: #888;
  }
</style>