---
import HomepageLayout from '../layouts/HomepageLayout.astro';

// This JavaScript logic is unchanged.
// 1. Fetch all articles
const allPostsData = await import.meta.glob('../content/articles/*.md', { eager: true });
const allPosts = Object.entries(allPostsData);

// 2. Find the one featured post
const featuredPostEntry = allPosts.find(([path, post]) => post.frontmatter.featured);

// 3. Create a new list of all other posts
const otherPosts = allPosts.filter(([path, post]) => !post.frontmatter.featured);
---
<HomepageLayout>
  <div class="home-container">
    {featuredPostEntry && (() => {
      const [path, post] = featuredPostEntry;
      const slug = path.split('/').pop().replace('.md', '');
      return (
        <section class="featured-story">
          <a href={`/posts/${slug}/`} class="card-link">
            <article>
              <h2>{post.frontmatter.title}</h2>
              <p class="meta">
                Published on {new Date(post.frontmatter.pubDate).toLocaleDateString()}
              </p>
              <p>{post.frontmatter.description}</p>
            </article>
          </a>
        </section>
      )
    })()}

    <section class="more-stories">
      {otherPosts.map(([path, post]) => {
        const slug = path.split('/').pop().replace('.md', '');
        return (
          <a href={`/posts/${slug}/`} class="card-link">
            <article class="story-card">
              <h3>{post.frontmatter.title}</h3>
              <p class="meta">
                Published on {new Date(post.frontmatter.pubDate).toLocaleDateString()}
              </p>
            </article>
          </a>
        )
      })}
    </section>
  </div>
</HomepageLayout>

<style>
  .home-container {
    display: grid;
    grid-template-columns: 2fr 1fr; /* Main column is twice as wide as the side column */
    gap: 2rem;
  }

  .card-link {
    display: block;
    text-decoration: none;
    color: var(--color-text);
    height: 100%;
  }

  .card-link:hover h2,
  .card-link:hover h3 {
    text-decoration: underline;
  }

  /* Featured Story Styles */
  .featured-story .card-link {
    background-color: #fff;
    padding: 1.5rem;
    border: 1px solid var(--color-border);
    border-radius: 4px;
  }

  .featured-story h2 {
    font-size: 2.2rem;
    margin-top: 0;
    line-height: 1.1;
  }

  .featured-story p {
    font-size: 1.1rem;
    color: #555;
  }
  
  /* More Stories Styles */
  .more-stories .story-card {
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 1rem;
    margin-bottom: 1rem;
  }

  .more-stories .story-card:last-of-type {
    border-bottom: none;
    margin-bottom: 0;
  }

  .more-stories h3 {
    font-size: 1.25rem;
    margin: 0 0 0.25rem 0;
    line-height: 1.3;
  }
  
  .story-card .meta, 
  .featured-story .meta {
    font-size: 0.9em;
    color: #888;
  }

  /* Responsive styles for mobile and tablets */
  @media (max-width: 768px) {
    .home-container {
      grid-template-columns: 1fr; /* Stack into a single column */
    }
    .featured-story h2 {
      font-size: 1.8rem;
    }
  }
</style>